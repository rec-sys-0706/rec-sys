{% extends "./layout/main_layout.html" %}

{% block content %}
    <div class="container 2xl:max-w-7xl mx-auto flex justify-between">
        <div class="w-[48%]">
            <h2 class="text-2xl mt-3 mb-3 ml-0 mr-0 font-semibold text-[var(--sail-700)]">為您推薦</h2>
            {% if recommend_news|length == 0 %}
                {% if status == 'Login' %}
                    <p>目前沒有推薦的文章，稍後再來看看吧！</p>
                {% else %}
                    <p>請先<a href="/main/login" class="font-bold no-underline text-[#00335f] hover:text-[#00335f] hover:no-underline">登入</a>，讓我們為您推薦文章</p>
                {% endif %}
            {% else %}
                {% set news_count = recommend_news|length %}
                {% from 'components/doc_block.html' import render_block %}
                {% for index in range(news_count) %}
                    <div class="mb-5">
                        {% with 
                            link=recommend_news.iloc[index]['link']|e,
                            title=recommend_news.iloc[index]['title'],
                            category=recommend_news.iloc[index]['category'],
                            abstract=recommend_news.iloc[index]['abstract'],
                            datetime=recommend_news.iloc[index]['gattered_datetime']
                        %}
                            {{ render_block(link, title, abstract, category, datetime) }}
                        {% endwith %}
                    </div>
                {% endfor %}
            {% endif %}
        </div>

        <div class="w-[48%]">
            <h2 class="text-2xl mt-3 mb-3 ml-0 mr-0 font-semibold text-[var(--sail-700)]">其他文章</h2>
            {% set news_count = unrecommend_news|length %}
            {% from 'components/doc_block.html' import render_block %}
            {% for index in range(news_count) %}
                <div class="mb-5">
                    {% with 
                        link=unrecommend_news.iloc[index]['link']|e,
                        title=unrecommend_news.iloc[index]['title'],
                        category=unrecommend_news.iloc[index]['category'],
                        abstract=unrecommend_news.iloc[index]['abstract'],
                        datetime=unrecommend_news.iloc[index]['gattered_datetime']
                    %}
                        {{ render_block(link, title, abstract, category, datetime) }}
                    {% endwith %}
                </div>
            {% endfor %}
        </div>

    </div>

    <script>
        function sendValueAndRedirect(element) {
            var link = element.getAttribute('data-link');
        
            // 立即打開新鏈接，不等待 fetch 完成
            window.open(link, '_blank');
        
            // 後台發送數據到伺服器，無需等待回應
            fetch('/main', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    link: link
                })
            }).catch(error => {
                console.error('Error sending data:', error);
            });
        
            // 阻止默認行為，防止瀏覽器重定向
            return false;
        }
    </script>
{% endblock %}
